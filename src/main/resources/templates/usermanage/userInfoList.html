<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: header (pageTitle='用户管理')">
    <!-- META SECTION -->
    <title>Joli Admin - Responsive Bootstrap Admin Template</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <!-- END META SECTION -->

    <!-- CSS INCLUDE -->
    <link rel="stylesheet" type="text/css"  href="/css/theme-default.css"/>
    <link rel="stylesheet" type="text/css"  href="/css/bootstrap-table.min.css"/>
    <!-- EOF CSS INCLUDE -->
</head>


<body>



<!-- START PAGE CONTAINER -->
<div class="page-container page-navigation-top-fixed">

    <!-- START PAGE SIDEBAR -->
    <div th:include="fragments/layout :: sideBar" th:remove="tag"></div>
    <!-- END PAGE SIDEBAR -->



    <!-- PAGE CONTENT -->
    <div class="page-content">

        <!-- START X-NAVIGATION VERTICAL -->
        <div th:include="fragments/layout :: contentTop" th:remove="tag"></div>
        <!-- END X-NAVIGATION VERTICAL -->

        <!-- START BREADCRUMB -->
        <ul class="breadcrumb">
            <li ><a href="index">首页</a></li>
            <li class="active">用户列表</li>
        </ul>
        <!-- END BREADCRUMB -->

        <div class="page-title">
            <h2><a href="/"><span class="fa fa-arrow-circle-o-left"></span></a>  用户列表</h2>
        </div>

        <!--状态提示框-->
        <div id="alertBoxDiv"></div>
        <!-- PAGE CONTENT WRAPPER -->
        <div class="page-content-wrap">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <table id="userInfoDataTable" class="table">
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PAGE CONTENT WRAPPER -->
    </div>
    <!-- END PAGE CONTENT -->
</div>
<!-- END PAGE CONTAINER -->
<div class="modal fade" id="userInfoModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document" id="userInfoModalDialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="userInfoModalLabel">用户编辑</h4>
            </div>
            <form  method="post" class="form-horizontal" role="form" id="userInfoForm">
                <div class="modal-body">

                    <input id="uid" name="uid" value="" type="hidden" />


                    <div class="form-group">
                        <label for="username" class="col-sm-2 control-label">账号:</label>
                        <div class="col-sm-10">
                            <input type="text" name="username" class="form-control" id="username" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="name" class="col-sm-2 control-label">昵称:</label>
                        <div class="col-sm-10">
                            <input type="text" name="name" class="form-control" id="name" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="true_name" class="col-sm-2 control-label">真实姓名:</label>
                        <div class="col-sm-10">
                            <input type="text" name="true_name" class="form-control" id="true_name" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="birth_date" class="col-sm-2 control-label">出生日期:</label>
                        <div class="col-sm-10">
                            <input type="date" value="<%=date%>" name="birth_date" class="form-control" id="birth_date" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="city" class="col-sm-2 control-label">国家:</label>
                        <div class="col-sm-10">
                            <input type="text" name="city" class="form-control" id="city" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email" class="col-sm-2 control-label">邮件:</label>
                        <div class="col-sm-10">
                            <input type="text" name="email" class="form-control" id="email" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="we_chat_account" class="col-sm-2 control-label">微信:</label>
                        <div class="col-sm-10">
                            <input type="text" name="we_chat_account" class="form-control" id="we_chat_account" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="qq" class="col-sm-2 control-label">qq:</label>
                        <div class="col-sm-10">
                            <input type="text" name="qq" class="form-control" id="qq" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address" class="col-sm-2 control-label">住址:</label>
                        <div class="col-sm-10">
                            <input type="text" name="address" class="form-control" id="address" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone" class="col-sm-2 control-label">电话号码:</label>
                        <div class="col-sm-10">
                            <input type="text" name="phone" class="form-control" id="phone" readonly="readonly"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="info_shield" class="col-sm-2 control-label">信息屏蔽设置:</label>
                        <div class="col-sm-10">
                            <select id="info_shield"  name="info_shield" class="form-control" style="-webkit-appearance:menulist">

                                <option value="0">不屏蔽</option>
                                <option value="1">屏蔽</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label  class="col-sm-2 control-label">性别:</label>
                        <div class="col-sm-2">
                            <input type="radio" name="sex" value="1"  readonly="readonly"/>男<span></span>
                        </div>
                        <div class="col-sm-2">
                            <input type="radio" name="sex" value="0"  readonly="readonly"/>女<span></span>
                        </div>
                    </div>


                    <div class="form-group">
                        <label for="ip_address" class="col-sm-2 control-label">最后登陆ip地址:</label>
                        <div class="col-sm-10">
                            <input type="text" name="ip_address" class="form-control" id="ip_address" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="new_time" class="col-sm-2 control-label">创建时间:</label>
                        <div class="col-sm-10">
                            <input type="text" name="new_time" class="form-control" id="new_time" readonly="readonly"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="last_login_time" class="col-sm-2 control-label">最后登陆时间:</label>
                        <div class="col-sm-10">
                            <input type="text" name="last_login_time" class="form-control" id="last_login_time" readonly="readonly"/>
                        </div>
                    </div>



                    <div class="form-group">
                        <label for="state" class="col-sm-2 control-label">状态:</label>
                        <div class="col-sm-10">
                            <select id="state"  name="state" class="form-control" style="-webkit-appearance:menulist">
                                <option value="0">未认证</option>
                                <option value="1">正常</option>
                                <option value="2">锁定</option>
                            </select>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button id="modalButton" type="button" onclick="userInfoDataUpdate()" class="btn btn-primary">提交更改</button>
                </div>
            </form>
        </div><!-- /.modal-content -->
    </div>
</div><!-- /.modal -->




<div th:include="fragments/layout :: messageBox" th:remove="tag">

</div>


<!-- START SCRIPTS -->
<div th:include="fragments/layout :: allHasJs" th:remove="tag">

</div>

<!-- START THIS PAGE PLUGINS-->
<script type='text/javascript' src='/js/plugins/icheck/icheck.min.js'></script>
<script type="text/javascript" src="/js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js"></script>
<script type="text/javascript" src="/js/plugins/scrolltotop/scrolltopcontrol.js"></script>

<script type="text/javascript" src="/js/plugins/morris/raphael-min.js"></script>
<script type="text/javascript" src="/js/plugins/morris/morris.min.js"></script>
<script type="text/javascript" src="/js/plugins/rickshaw/d3.v3.js"></script>
<script type="text/javascript" src="/js/plugins/rickshaw/rickshaw.min.js"></script>
<script type='text/javascript' src='/js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js'></script>
<script type='text/javascript' src='/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js'></script>
<script type='text/javascript' src='/js/plugins/bootstrap/bootstrap-datepicker.js'></script>
<script type="text/javascript" src="/js/plugins/owl/owl.carousel.min.js"></script>

<script type="text/javascript" src="/js/plugins/moment.min.js"></script>
<script type="text/javascript" src="/js/plugins/daterangepicker/daterangepicker.js"></script>

<script type="text/javascript" src="/js/plugins/bootstrap/bootstrap-table.min.js"></script>
<script type="text/javascript" src="/js/plugins/bootstrap/bootstrap-table-zh-CN.min.js"></script>

<!-- END THIS PAGE PLUGINS-->

<!-- START TEMPLATE -->
<div th:include="fragments/layout :: templateJs" th:remove="tag"></div>
<!-- END TEMPLATE -->
<!-- END SCRIPTS -->
<script>
//$.ajax({
//    url: "/AuthorizationManage/userInfos",
//    dataType: "json",
//    success:function (value) {
//
//    }
//})


    $('#userInfoDataTable').bootstrapTable({
        url: "/AuthorizationManage/userInfos",
        dataType: "json",
        pagination:true,
        sidePagination: "server",
        columns: [{
            field: 'uid',
            title: '用户id'
        }, {
            field: 'username',
            title: '账号'
        }
        ,{
            field: 'roles',
            title: '角色',
            formatter:function(value,row,index){
                var roleNames = '';
                $.each(value,function (index, role) {
                    roleNames +=' '+role['role_describe'];
                })
                return roleNames;
            }

        }, {
                field: 'ip_address',
                title: '最后登录ip地址'
            }, {
                field: 'last_login_time',
                title: '最后登陆时间'
            }, {
                field: 'state',
                title: '账户状态'
            },{
                field: 'uid',
                title: '操作',
                formatter:function(value,row,index){
                    var e = '<button class="btn" onclick="userInfoModalDisplay(' + value + ')" >编辑</button> ';
                    var d = '<button class="btn" onclick="userInfoDelete(' + value + ')" >删除</button>';
                    return e+d;
                }
            }
        ],
        toolbar:'#toolbar'
    });
    var alertBox = new AlertBox('alertBoxDiv');




    function userInfoModalDisplay(userInfoId){
        $('#uid').attr("disabled",false);

        fillFormUseAjax({
            url:'/AuthorizationManage/userInfos/' + userInfoId
        },$('#userInfoForm'));
        $("#userInfoModal").modal("show");
        $("#userInfoModalDialog").css("z-index", "1500");
    }

    function userInfoDataUpdate() {
        ajaxFormSubmit({
            url:'/AuthorizationManage/userInfoUpdate',
            type:'post',

            success:function (data) {
                $("#userInfoModal").modal("hide");
                if(data['statusCode'] === 1000){
                    alertBox.addNewAlert('success',"操作成功","你所做的修改已生效");
                    $('#userInfoDataTable').bootstrapTable('refresh');

                }else{
                    alertBox.addNewAlert('danger',"操作失败",data['message']);
                    $('#userInfoDataTable').bootstrapTable('refresh');
                }
                reflashUserData();

            },
            error:function (e) {

            }
        },'userInfoForm')
    }
    function userInfoDelete(userInfoId){
        if(!window.confirm("确认删除该用户吗")){
            return false;
        }
        $.ajax({
            url:'/AuthorizationManage/userInfoDelete',
            type: 'POST',
            data:{
                id:userInfoId
            },
            success:function (data) {
                if(data['statusCode'] === 1000){
                    alertBox.addNewAlert('success',"操作成功","已删除所选记录");
                    $('#userInfoDataTable').bootstrapTable('refresh');
                }else{
                    alertBox.addNewAlert('danger',"操作失败",data['message']);
                    $('#userInfoDataTable').bootstrapTable('refresh');
                }
                reflashUserData();
            },
            error:function (e) {

            }
        });
    }

</script>
</body>
</html>






